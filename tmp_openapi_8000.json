{"openapi":"3.1.0","info":{"title":"TomeHub API","description":"Unified Backend for TomeHub (Search + AI + Ingestion)","version":"2.0.0"},"paths":{"/api/flow/start":{"post":{"tags":["Flux (Layer 4)"],"summary":"Flow Start","description":"Start a new Flux session.","operationId":"flow_start_api_flow_start_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowStartRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowStartResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/flow/next":{"post":{"tags":["Flux (Layer 4)"],"summary":"Flow Next","description":"Get the next batch of cards in the Flux.","operationId":"flow_next_api_flow_next_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowNextRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowNextResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/flow/feedback":{"post":{"tags":["Flux (Layer 4)"],"summary":"Flow Feedback","description":"Submit feedback on a card (like, dislike, skip, save).\nUsed to adjust the stream in real-time.","operationId":"flow_feedback_api_flow_feedback_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FlowFeedbackRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/flow/adjust":{"post":{"tags":["Flux (Layer 4)"],"summary":"Flow Adjust","description":"Adjust the Horizon Slider mid-session.","operationId":"flow_adjust_api_flow_adjust_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_flow_adjust_api_flow_adjust_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/flow/reset-anchor":{"post":{"tags":["Flux (Layer 4)"],"summary":"Flow Reset Anchor","description":"Explicitly reset the session anchor (Change Topic).","operationId":"flow_reset_anchor_api_flow_reset_anchor_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_flow_reset_anchor_api_flow_reset_anchor_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/flow/session/{session_id}":{"get":{"tags":["Flux (Layer 4)"],"summary":"Get Session Info","description":"Get current session state (for debugging/UI sync).","operationId":"get_session_info_api_flow_session__session_id__get","parameters":[{"name":"session_id","in":"path","required":true,"schema":{"type":"string","title":"Session Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ai/enrich-book":{"post":{"tags":["AI Tools"],"summary":"Enrich Book Endpoint","description":"Enrich a single book with metadata (Summary, Tags, etc.)","operationId":"enrich_book_endpoint_api_ai_enrich_book_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/EnrichBookRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ai/enrich-batch":{"post":{"tags":["AI Tools"],"summary":"Enrich Batch Endpoint","description":"Stream enriched books back to client using SSE.\nExpects JSON body: { \"books\": [...] }","operationId":"enrich_batch_endpoint_api_ai_enrich_batch_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/ai/generate-tags":{"post":{"tags":["AI Tools"],"summary":"Generate Tags Endpoint","operationId":"generate_tags_endpoint_api_ai_generate_tags_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/GenerateTagsRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ai/verify-cover":{"post":{"tags":["AI Tools"],"summary":"Verify Cover Endpoint","operationId":"verify_cover_endpoint_api_ai_verify_cover_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/VerifyCoverRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ai/analyze-highlights":{"post":{"tags":["AI Tools"],"summary":"Analyze Highlights Endpoint","operationId":"analyze_highlights_endpoint_api_ai_analyze_highlights_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AnalyzeHighlightsRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ai/search-resources":{"post":{"tags":["AI Tools"],"summary":"Search Resources Endpoint","operationId":"search_resources_endpoint_api_ai_search_resources_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/Body_search_resources_endpoint_api_ai_search_resources_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/metrics":{"get":{"summary":"Metrics","description":"Endpoint that serves Prometheus metrics.","operationId":"metrics_metrics_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/":{"get":{"summary":"Health Check","operationId":"health_check__get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/realtime/poll":{"get":{"summary":"Realtime Poll","description":"Fast polling endpoint for multi-device UX consistency.\nReturns coarse-grained change events since client timestamp.","operationId":"realtime_poll_api_realtime_poll_get","parameters":[{"name":"since_ms","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Since Ms"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":100,"title":"Limit"}},{"name":"firebase_uid","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firebase Uid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/search":{"post":{"summary":"Search","operationId":"search_api_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/chat":{"post":{"summary":"Chat Endpoint","description":"Stateful Chat Endpoint (LogosChat - Layer 3).\nOrchestrates session, history, and RAG search.","operationId":"chat_endpoint_api_chat_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{"$ref":"#/components/schemas/ChatResponse"}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/ingested-books":{"get":{"summary":"Get Ingested Books","description":"Returns list of book_ids that have ingested PDF content for the user.","operationId":"get_ingested_books_api_analytics_ingested_books_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/analytics/epistemic-distribution":{"get":{"summary":"Get Epistemic Distribution Endpoint","operationId":"get_epistemic_distribution_endpoint_api_analytics_epistemic_distribution_get","parameters":[{"name":"book_id","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Book Id"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":250,"title":"Limit"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/concordance":{"get":{"summary":"Get Concordance","description":"Endpoint for paginated KWIC (Concordance) retrieval.","operationId":"get_concordance_api_analytics_concordance_get","parameters":[{"name":"book_id","in":"query","required":true,"schema":{"type":"string","title":"Book Id"}},{"name":"term","in":"query","required":true,"schema":{"type":"string","title":"Term"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":50,"title":"Limit"}},{"name":"offset","in":"query","required":false,"schema":{"type":"integer","default":0,"title":"Offset"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/distribution":{"get":{"summary":"Get Distribution","description":"Endpoint for keyword distribution across pages.","operationId":"get_distribution_api_analytics_distribution_get","parameters":[{"name":"book_id","in":"query","required":true,"schema":{"type":"string","title":"Book Id"}},{"name":"term","in":"query","required":true,"schema":{"type":"string","title":"Term"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/analytics/compare":{"post":{"summary":"Get Comparative Stats Endpoint","description":"Endpoint for cross-book keyword comparison.","operationId":"get_comparative_stats_endpoint_api_analytics_compare_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/ComparisonRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/smart-search":{"post":{"summary":"Perform Search","description":"Pure weighted search (Search - Layer 2).","operationId":"perform_search_api_smart_search_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/SearchRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/feedback":{"post":{"summary":"Feedback","operationId":"feedback_api_feedback_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/FeedbackRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/extract-metadata":{"post":{"summary":"Extract Metadata Endpoint","operationId":"extract_metadata_endpoint_api_extract_metadata_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_extract_metadata_endpoint_api_extract_metadata_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/reports/search":{"get":{"summary":"Search Reports","operationId":"search_reports_api_reports_search_get","parameters":[{"name":"topic","in":"query","required":true,"schema":{"type":"string","title":"Topic"}},{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":20,"title":"Limit"}},{"name":"firebase_uid","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firebase Uid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/ingest":{"post":{"summary":"Ingest Endpoint","operationId":"ingest_endpoint_api_ingest_post","requestBody":{"content":{"multipart/form-data":{"schema":{"$ref":"#/components/schemas/Body_ingest_endpoint_api_ingest_post"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/books/{book_id}/ingestion-status":{"get":{"summary":"Get Ingestion Status","operationId":"get_ingestion_status_api_books__book_id__ingestion_status_get","parameters":[{"name":"book_id","in":"path","required":true,"schema":{"type":"string","title":"Book Id"}},{"name":"firebase_uid","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firebase Uid"}},{"name":"title","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Title"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/recalculate_graph":{"post":{"summary":"Recalculate Graph Endpoint","description":"Triggers the graph centrality recalculation script in the background.\nUseful after bulk ingesting new books to update discovery bridges.","operationId":"recalculate_graph_endpoint_api_admin_recalculate_graph_post","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/admin/external-kb/backfill/start":{"post":{"summary":"Start External Kb Backfill","operationId":"start_external_kb_backfill_api_admin_external_kb_backfill_start_post","parameters":[{"name":"all_users","in":"query","required":false,"schema":{"type":"boolean","default":false,"title":"All Users"}},{"name":"firebase_uid","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firebase Uid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/admin/external-kb/backfill/status":{"get":{"summary":"External Kb Backfill Status","operationId":"external_kb_backfill_status_api_admin_external_kb_backfill_status_get","parameters":[{"name":"firebase_uid","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Firebase Uid"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/library/items":{"get":{"summary":"List Library Items Endpoint","operationId":"list_library_items_endpoint_api_library_items_get","parameters":[{"name":"limit","in":"query","required":false,"schema":{"type":"integer","default":1000,"title":"Limit"}},{"name":"cursor","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Cursor"}},{"name":"types","in":"query","required":false,"schema":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Types"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/library/items/{item_id}":{"put":{"summary":"Upsert Library Item Endpoint","operationId":"upsert_library_item_endpoint_api_library_items__item_id__put","parameters":[{"name":"item_id","in":"path","required":true,"schema":{"type":"string","title":"Item Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LibraryItemUpsertRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"summary":"Patch Library Item Endpoint","operationId":"patch_library_item_endpoint_api_library_items__item_id__patch","parameters":[{"name":"item_id","in":"path","required":true,"schema":{"type":"string","title":"Item Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LibraryItemPatchRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Delete Library Item Endpoint","operationId":"delete_library_item_endpoint_api_library_items__item_id__delete","parameters":[{"name":"item_id","in":"path","required":true,"schema":{"type":"string","title":"Item Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/library/items/bulk-delete":{"post":{"summary":"Bulk Delete Library Items Endpoint","operationId":"bulk_delete_library_items_endpoint_api_library_items_bulk_delete_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/LibraryBulkDeleteRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/library/personal-note-folders":{"get":{"summary":"List Personal Note Folders Endpoint","operationId":"list_personal_note_folders_endpoint_api_library_personal_note_folders_get","responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}}}}},"/api/library/personal-note-folders/{folder_id}":{"put":{"summary":"Upsert Personal Note Folder Endpoint","operationId":"upsert_personal_note_folder_endpoint_api_library_personal_note_folders__folder_id__put","parameters":[{"name":"folder_id","in":"path","required":true,"schema":{"type":"string","title":"Folder Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PersonalNoteFolderUpsertRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"patch":{"summary":"Patch Personal Note Folder Endpoint","operationId":"patch_personal_note_folder_endpoint_api_library_personal_note_folders__folder_id__patch","parameters":[{"name":"folder_id","in":"path","required":true,"schema":{"type":"string","title":"Folder Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PersonalNoteFolderPatchRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}},"delete":{"summary":"Delete Personal Note Folder Endpoint","operationId":"delete_personal_note_folder_endpoint_api_library_personal_note_folders__folder_id__delete","parameters":[{"name":"folder_id","in":"path","required":true,"schema":{"type":"string","title":"Folder Id"}}],"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/add-item":{"post":{"summary":"Add Item Endpoint","operationId":"add_item_endpoint_api_add_item_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/AddItemRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/books/{book_id}/sync-highlights":{"post":{"summary":"Sync Highlights Endpoint","operationId":"sync_highlights_endpoint_api_books__book_id__sync_highlights_post","parameters":[{"name":"book_id","in":"path","required":true,"schema":{"type":"string","title":"Book Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/HighlightSyncRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/notes/{book_id}/sync-personal-note":{"post":{"summary":"Sync Personal Note Endpoint","operationId":"sync_personal_note_endpoint_api_notes__book_id__sync_personal_note_post","parameters":[{"name":"book_id","in":"path","required":true,"schema":{"type":"string","title":"Book Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PersonalNoteSyncRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/resources/{book_id}/purge":{"post":{"summary":"Purge Resource Endpoint","operationId":"purge_resource_endpoint_api_resources__book_id__purge_post","parameters":[{"name":"book_id","in":"path","required":true,"schema":{"type":"string","title":"Book Id"}}],"requestBody":{"required":true,"content":{"application/json":{"schema":{"$ref":"#/components/schemas/PurgeResourceRequest"}}}},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}},"/api/migrate_bulk":{"post":{"summary":"Migrate Bulk Endpoint","operationId":"migrate_bulk_endpoint_api_migrate_bulk_post","requestBody":{"content":{"application/json":{"schema":{"$ref":"#/components/schemas/BatchMigrateRequest"}}},"required":true},"responses":{"200":{"description":"Successful Response","content":{"application/json":{"schema":{}}}},"422":{"description":"Validation Error","content":{"application/json":{"schema":{"$ref":"#/components/schemas/HTTPValidationError"}}}}}}}},"components":{"schemas":{"AddItemRequest":{"properties":{"text":{"type":"string","maxLength":20000,"minLength":1,"title":"Text"},"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"type":{"type":"string","title":"Type","default":"PERSONAL_NOTE"},"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Book Id"},"page_number":{"anyOf":[{"type":"integer","maximum":100000.0,"minimum":0.0},{"type":"null"}],"title":"Page Number"},"chunk_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Chunk Type"},"chunk_index":{"anyOf":[{"type":"integer","maximum":1000000.0,"minimum":0.0},{"type":"null"}],"title":"Chunk Index"},"comment":{"anyOf":[{"type":"string","maxLength":4000},{"type":"null"}],"title":"Comment"},"tags":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tags"}},"type":"object","required":["text","title","author","firebase_uid"],"title":"AddItemRequest"},"AnalyzeHighlightsRequest":{"properties":{"highlights":{"items":{"type":"string"},"type":"array","maxItems":200,"minItems":1,"title":"Highlights"}},"type":"object","title":"AnalyzeHighlightsRequest"},"BatchMigrateRequest":{"properties":{"items":{"items":{"additionalProperties":true,"type":"object"},"type":"array","maxItems":500,"minItems":1,"title":"Items"},"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"}},"type":"object","required":["firebase_uid"],"title":"BatchMigrateRequest"},"Body_extract_metadata_endpoint_api_extract_metadata_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"}},"type":"object","required":["file"],"title":"Body_extract_metadata_endpoint_api_extract_metadata_post"},"Body_flow_adjust_api_flow_adjust_post":{"properties":{"session_id":{"type":"string","title":"Session Id"},"horizon_value":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Horizon Value"}},"type":"object","required":["session_id","horizon_value"],"title":"Body_flow_adjust_api_flow_adjust_post"},"Body_flow_reset_anchor_api_flow_reset_anchor_post":{"properties":{"session_id":{"type":"string","title":"Session Id"},"anchor_type":{"type":"string","title":"Anchor Type"},"anchor_id":{"type":"string","title":"Anchor Id"},"firebase_uid":{"type":"string","title":"Firebase Uid"},"resource_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Type"},"category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category"}},"type":"object","required":["session_id","anchor_type","anchor_id","firebase_uid"],"title":"Body_flow_reset_anchor_api_flow_reset_anchor_post"},"Body_ingest_endpoint_api_ingest_post":{"properties":{"file":{"type":"string","format":"binary","title":"File"},"title":{"type":"string","title":"Title"},"author":{"type":"string","title":"Author"},"firebase_uid":{"type":"string","title":"Firebase Uid"},"book_id":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Book Id"},"tags":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Tags"}},"type":"object","required":["file","title","author","firebase_uid"],"title":"Body_ingest_endpoint_api_ingest_post"},"Body_search_resources_endpoint_api_ai_search_resources_post":{"properties":{"query":{"type":"string","title":"Query"},"type":{"type":"string","title":"Type"}},"type":"object","required":["query","type"],"title":"Body_search_resources_endpoint_api_ai_search_resources_post"},"ChatRequest":{"properties":{"message":{"type":"string","maxLength":2000,"minLength":1,"title":"Message"},"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"session_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Session Id"},"book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Book Id"},"context_book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Context Book Id"},"resource_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Resource Type"},"scope_mode":{"type":"string","title":"Scope Mode","default":"AUTO"},"compare_mode":{"type":"string","title":"Compare Mode","default":"EXPLICIT_ONLY"},"target_book_ids":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Target Book Ids"},"mode":{"type":"string","title":"Mode","default":"STANDARD"},"limit":{"type":"integer","maximum":100.0,"minimum":1.0,"title":"Limit","default":20},"offset":{"type":"integer","maximum":10000.0,"minimum":0.0,"title":"Offset","default":0}},"type":"object","required":["message","firebase_uid"],"title":"ChatRequest"},"ChatResponse":{"properties":{"answer":{"type":"string","title":"Answer"},"session_id":{"type":"integer","title":"Session Id"},"sources":{"items":{},"type":"array","title":"Sources"},"timestamp":{"type":"string","title":"Timestamp"},"conversation_state":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Conversation State"},"thinking_history":{"anyOf":[{"items":{},"type":"array"},{"type":"null"}],"title":"Thinking History"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["answer","session_id","sources","timestamp"],"title":"ChatResponse"},"ComparisonRequest":{"properties":{"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"target_book_ids":{"items":{"type":"string"},"type":"array","maxItems":20,"minItems":2,"title":"Target Book Ids"},"term":{"type":"string","maxLength":128,"minLength":1,"title":"Term"}},"type":"object","required":["firebase_uid","term"],"title":"ComparisonRequest"},"EnrichBookRequest":{"properties":{"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"publisher":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Publisher"},"isbn":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Isbn"},"summary":{"anyOf":[{"type":"string","maxLength":4000},{"type":"null"}],"title":"Summary"},"tags":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tags"},"content_language_mode":{"anyOf":[{"type":"string","maxLength":8},{"type":"null"}],"title":"Content Language Mode","default":"AUTO"},"source_language_hint":{"anyOf":[{"type":"string","maxLength":16},{"type":"null"}],"title":"Source Language Hint"},"force_regenerate":{"type":"boolean","title":"Force Regenerate","default":false}},"additionalProperties":true,"type":"object","required":["title","author"],"title":"EnrichBookRequest"},"FeedbackRequest":{"properties":{"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"query":{"type":"string","maxLength":2000,"minLength":1,"title":"Query"},"answer":{"type":"string","maxLength":10000,"minLength":1,"title":"Answer"},"rating":{"anyOf":[{"type":"integer","maximum":5.0,"minimum":1.0},{"type":"null"}],"title":"Rating"},"comment":{"anyOf":[{"type":"string","maxLength":2000},{"type":"null"}],"title":"Comment"},"search_log_id":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Search Log Id"},"book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Book Id"}},"type":"object","required":["firebase_uid","query","answer"],"title":"FeedbackRequest"},"FlowCard":{"properties":{"flow_id":{"type":"string","title":"Flow Id"},"chunk_id":{"type":"string","title":"Chunk Id"},"content":{"type":"string","title":"Content"},"title":{"type":"string","title":"Title"},"author":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Author"},"page_number":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Page Number"},"source_type":{"type":"string","enum":["personal","pdf_chunk","graph_bridge","external"],"title":"Source Type"},"epistemic_level":{"type":"string","enum":["A","B","C"],"title":"Epistemic Level","default":"B"},"reason":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Reason"},"zone":{"type":"integer","title":"Zone","default":1}},"type":"object","required":["flow_id","chunk_id","content","title","source_type"],"title":"FlowCard","description":"A single card in the Flow stream."},"FlowFeedbackRequest":{"properties":{"firebase_uid":{"type":"string","title":"Firebase Uid"},"session_id":{"type":"string","title":"Session Id"},"chunk_id":{"type":"string","title":"Chunk Id"},"action":{"type":"string","enum":["like","dislike","skip","save"],"title":"Action"}},"type":"object","required":["firebase_uid","session_id","chunk_id","action"],"title":"FlowFeedbackRequest","description":"User feedback on a shown card."},"FlowMode":{"type":"string","enum":["FOCUS","EXPAND","DISCOVER","BRIDGE"],"title":"FlowMode","description":"Flow session modes (maps to Horizon Slider)."},"FlowNextRequest":{"properties":{"firebase_uid":{"type":"string","title":"Firebase Uid"},"session_id":{"type":"string","title":"Session Id"},"batch_size":{"type":"integer","maximum":10.0,"minimum":1.0,"title":"Batch Size","default":5}},"type":"object","required":["firebase_uid","session_id"],"title":"FlowNextRequest","description":"Request to get the next batch of cards."},"FlowNextResponse":{"properties":{"cards":{"items":{"$ref":"#/components/schemas/FlowCard"},"type":"array","title":"Cards"},"has_more":{"type":"boolean","title":"Has More","default":true},"pivot_info":{"anyOf":[{"$ref":"#/components/schemas/PivotInfo"},{"type":"null"}]},"session_state":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Session State"}},"type":"object","required":["cards"],"title":"FlowNextResponse","description":"Response with the next batch of cards."},"FlowStartRequest":{"properties":{"firebase_uid":{"type":"string","title":"Firebase Uid"},"anchor_type":{"type":"string","enum":["note","book","author","topic"],"title":"Anchor Type","default":"note"},"anchor_id":{"type":"string","title":"Anchor Id"},"mode":{"$ref":"#/components/schemas/FlowMode","default":"FOCUS"},"horizon_value":{"type":"number","maximum":1.0,"minimum":0.0,"title":"Horizon Value","default":0.25},"resource_type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Resource Type"},"category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category"}},"type":"object","required":["firebase_uid","anchor_id"],"title":"FlowStartRequest","description":"Request to start a new Flow session."},"FlowStartResponse":{"properties":{"session_id":{"type":"string","title":"Session Id"},"initial_cards":{"items":{"$ref":"#/components/schemas/FlowCard"},"type":"array","title":"Initial Cards"},"topic_label":{"type":"string","title":"Topic Label"}},"type":"object","required":["session_id","initial_cards","topic_label"],"title":"FlowStartResponse","description":"Response after starting a Flow session."},"GenerateTagsRequest":{"properties":{"note_content":{"type":"string","maxLength":6000,"minLength":1,"title":"Note Content"}},"type":"object","required":["note_content"],"title":"GenerateTagsRequest"},"HTTPValidationError":{"properties":{"detail":{"items":{"$ref":"#/components/schemas/ValidationError"},"type":"array","title":"Detail"}},"type":"object","title":"HTTPValidationError"},"HighlightItem":{"properties":{"id":{"anyOf":[{"type":"string","maxLength":128},{"type":"null"}],"title":"Id"},"text":{"type":"string","maxLength":6000,"minLength":1,"title":"Text"},"type":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Type","default":"highlight"},"comment":{"anyOf":[{"type":"string","maxLength":2000},{"type":"null"}],"title":"Comment"},"pageNumber":{"anyOf":[{"type":"integer","maximum":100000.0,"minimum":0.0},{"type":"null"}],"title":"Pagenumber"},"tags":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tags"},"createdAt":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Createdat"}},"type":"object","required":["text"],"title":"HighlightItem"},"HighlightSyncRequest":{"properties":{"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"resource_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Resource Type"},"highlights":{"items":{"$ref":"#/components/schemas/HighlightItem"},"type":"array","maxItems":1000,"minItems":1,"title":"Highlights"}},"type":"object","required":["firebase_uid","title","author"],"title":"HighlightSyncRequest"},"LibraryBulkDeleteRequest":{"properties":{"item_ids":{"items":{"type":"string"},"type":"array","maxItems":500,"minItems":1,"title":"Item Ids"}},"type":"object","title":"LibraryBulkDeleteRequest"},"LibraryItemPatchRequest":{"properties":{"patch":{"additionalProperties":true,"type":"object","title":"Patch"}},"type":"object","title":"LibraryItemPatchRequest"},"LibraryItemUpsertRequest":{"properties":{"id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Id"},"type":{"type":"string","maxLength":64,"title":"Type","default":"BOOK"},"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"translator":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Translator"},"publisher":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Publisher"},"publicationYear":{"anyOf":[{"type":"string","maxLength":16},{"type":"null"}],"title":"Publicationyear"},"isbn":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Isbn"},"url":{"anyOf":[{"type":"string","maxLength":2000},{"type":"null"}],"title":"Url"},"status":{"anyOf":[{"type":"string","maxLength":128},{"type":"null"}],"title":"Status"},"readingStatus":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Readingstatus"},"tags":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tags"},"generalNotes":{"anyOf":[{"type":"string","maxLength":20000},{"type":"null"}],"title":"Generalnotes"},"summaryText":{"anyOf":[{"type":"string","maxLength":20000},{"type":"null"}],"title":"Summarytext"},"contentLanguageMode":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Contentlanguagemode"},"contentLanguageResolved":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Contentlanguageresolved"},"sourceLanguageHint":{"anyOf":[{"type":"string","maxLength":50},{"type":"null"}],"title":"Sourcelanguagehint"},"languageDecisionReason":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Languagedecisionreason"},"languageDecisionConfidence":{"anyOf":[{"type":"number"},{"type":"null"}],"title":"Languagedecisionconfidence"},"personalNoteCategory":{"anyOf":[{"type":"string","maxLength":32},{"type":"null"}],"title":"Personalnotecategory"},"personalFolderId":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Personalfolderid"},"folderPath":{"anyOf":[{"type":"string","maxLength":2000},{"type":"null"}],"title":"Folderpath"},"coverUrl":{"anyOf":[{"type":"string","maxLength":2000},{"type":"null"}],"title":"Coverurl"},"pageCount":{"anyOf":[{"type":"integer","maximum":100000.0,"minimum":0.0},{"type":"null"}],"title":"Pagecount"},"isFavorite":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Isfavorite","default":false},"addedAt":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Addedat"},"highlights":{"anyOf":[{"items":{"additionalProperties":true,"type":"object"},"type":"array"},{"type":"null"}],"title":"Highlights"}},"additionalProperties":true,"type":"object","required":["title","author"],"title":"LibraryItemUpsertRequest"},"PersonalNoteFolderPatchRequest":{"properties":{"name":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Name"},"category":{"anyOf":[{"type":"string","maxLength":32},{"type":"null"}],"title":"Category"},"order":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Order"},"updatedAt":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Updatedat"}},"type":"object","title":"PersonalNoteFolderPatchRequest"},"PersonalNoteFolderUpsertRequest":{"properties":{"id":{"anyOf":[{"type":"string","maxLength":255},{"type":"null"}],"title":"Id"},"category":{"anyOf":[{"type":"string","maxLength":32},{"type":"null"}],"title":"Category","default":"PRIVATE"},"name":{"type":"string","maxLength":255,"minLength":1,"title":"Name"},"order":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Order","default":0},"createdAt":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Createdat"},"updatedAt":{"anyOf":[{"type":"integer"},{"type":"null"}],"title":"Updatedat"}},"additionalProperties":true,"type":"object","required":["name"],"title":"PersonalNoteFolderUpsertRequest"},"PersonalNoteSyncRequest":{"properties":{"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"content":{"anyOf":[{"type":"string","maxLength":20000},{"type":"null"}],"title":"Content"},"tags":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Tags"},"category":{"anyOf":[{"type":"string"},{"type":"null"}],"title":"Category","default":"PRIVATE"},"delete_only":{"anyOf":[{"type":"boolean"},{"type":"null"}],"title":"Delete Only","default":false}},"type":"object","required":["firebase_uid","title","author"],"title":"PersonalNoteSyncRequest"},"PivotInfo":{"properties":{"type":{"type":"string","title":"Type"},"message":{"type":"string","title":"Message"}},"type":"object","required":["type","message"],"title":"PivotInfo","description":"Information about a discovery jump or automatic pivot."},"PurgeResourceRequest":{"properties":{"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"}},"type":"object","required":["firebase_uid"],"title":"PurgeResourceRequest"},"SearchRequest":{"properties":{"question":{"type":"string","maxLength":2000,"minLength":1,"title":"Question"},"firebase_uid":{"type":"string","maxLength":128,"minLength":1,"title":"Firebase Uid"},"book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Book Id"},"context_book_id":{"anyOf":[{"type":"string","maxLength":256},{"type":"null"}],"title":"Context Book Id"},"resource_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Resource Type"},"scope_mode":{"type":"string","title":"Scope Mode","default":"AUTO"},"compare_mode":{"type":"string","title":"Compare Mode","default":"EXPLICIT_ONLY"},"target_book_ids":{"anyOf":[{"items":{"type":"string"},"type":"array"},{"type":"null"}],"title":"Target Book Ids"},"mode":{"type":"string","title":"Mode","default":"STANDARD"},"include_private_notes":{"type":"boolean","title":"Include Private Notes","default":false},"visibility_scope":{"type":"string","maxLength":32,"title":"Visibility Scope","default":"default"},"content_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Content Type"},"ingestion_type":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Ingestion Type"},"limit":{"type":"integer","maximum":100.0,"minimum":1.0,"title":"Limit","default":20},"offset":{"type":"integer","maximum":10000.0,"minimum":0.0,"title":"Offset","default":0}},"type":"object","required":["question","firebase_uid"],"title":"SearchRequest"},"SearchResponse":{"properties":{"answer":{"type":"string","title":"Answer"},"sources":{"items":{},"type":"array","title":"Sources"},"timestamp":{"type":"string","title":"Timestamp"},"metadata":{"anyOf":[{"additionalProperties":true,"type":"object"},{"type":"null"}],"title":"Metadata"}},"type":"object","required":["answer","sources","timestamp"],"title":"SearchResponse"},"ValidationError":{"properties":{"loc":{"items":{"anyOf":[{"type":"string"},{"type":"integer"}]},"type":"array","title":"Location"},"msg":{"type":"string","title":"Message"},"type":{"type":"string","title":"Error Type"}},"type":"object","required":["loc","msg","type"],"title":"ValidationError"},"VerifyCoverRequest":{"properties":{"title":{"type":"string","maxLength":256,"minLength":1,"title":"Title"},"author":{"type":"string","maxLength":256,"minLength":1,"title":"Author"},"isbn":{"anyOf":[{"type":"string","maxLength":64},{"type":"null"}],"title":"Isbn"}},"type":"object","required":["title","author"],"title":"VerifyCoverRequest"}}}}