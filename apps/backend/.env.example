# TomeHub Backend Environment Configuration
# Copy this file to .env and fill in your credentials

# ============================================================================
# API KEYS
# ============================================================================
GEMINI_API_KEY=your_gemini_api_key_here
LLM_MODEL_LITE=gemini-2.5-flash-lite
LLM_MODEL_FLASH=gemini-2.5-flash
LLM_MODEL_PRO=gemini-2.5-pro
EMBEDDING_MODEL_NAME=gemini-embedding-001
LLM_PRO_FALLBACK_ENABLED=true
LLM_PRO_FALLBACK_MAX_PER_REQUEST=1
NVIDIA_API_KEY=your_nvidia_api_key_here
NVIDIA_BASE_URL=https://integrate.api.nvidia.com
LLM_EXPLORER_QWEN_PILOT_ENABLED=false
LLM_EXPLORER_PRIMARY_PROVIDER=qwen
LLM_EXPLORER_PRIMARY_MODEL=qwen/qwen3-next-80b-a3b-instruct
LLM_EXPLORER_FALLBACK_PROVIDER=gemini
LLM_EXPLORER_RPM_CAP=35
LLM_EXPLORER_SECONDARY_MAX_PER_REQUEST=1
# Deprecated (backward compatible): ANSWER_MODEL_NAME
# ANSWER_MODEL_NAME=gemini-2.5-flash
LLM_MODEL_VERSION=v2
EMBEDDING_MODEL_VERSION=v3

# ============================================================================
# AUTH (DEVELOPMENT ONLY)
# ============================================================================
# WARNING: Do not enable in staging/production.
DEV_UNSAFE_AUTH_BYPASS=false
LOG_LEVEL=INFO
DEBUG_VERBOSE_PIPELINE=false

# ============================================================================
# ORACLE DATABASE
# ============================================================================
DB_USER=ADMIN
DB_PASSWORD=your_database_password_here
DB_DSN=your_database_dsn_string

# ============================================================================
# ORACLE CLOUD INFRASTRUCTURE (OCI) - For PDF OCR
# ============================================================================
OCI_USER_OCID=ocid1.user.oc1..your_user_ocid
OCI_TENANCY_OCID=ocid1.tenancy.oc1..your_tenancy_ocid
OCI_FINGERPRINT=your:api:key:fingerprint
OCI_REGION=eu-frankfurt-1
OCI_KEY_FILE=./oci_private_key.pem
OCI_COMPARTMENT_ID=ocid1.compartment.oc1..your_compartment_ocid

# ============================================================================
# CHAT / MEMORY LIMITS
# ============================================================================
CHAT_CONTEXT_LIMIT=5
CHAT_PROMPT_TURNS=3
CHAT_SUMMARY_LIMIT=10
CHAT_RETENTION_DAYS=90
CHAT_TITLE_MIN_MESSAGES=3
CHAT_TITLE_MAX_LENGTH=60

# ============================================================================
# GRAPH / CONCEPT SETTINGS
# ============================================================================
CONCEPT_STRENGTH_MIN=0.7
GRAPH_ENRICH_ON_INGEST=true
GRAPH_ENRICH_MAX_ITEMS=1
GRAPH_ENRICH_TIMEOUT_SEC=20

# ============================================================================
# EXTERNAL KB (WIKIDATA + OPENALEX)
# ============================================================================
ACADEMIC_TAG_SET=sosyoloji,felsefe,psikoloji,ekonomi,tarih,hukuk,bilim,siyaset,politika,etik,metodoloji,teori,toplum,devlet,kamu,modernite
EXTERNAL_KB_ENABLED=true
EXTERNAL_KB_OPENALEX_EXPLORER_ONLY=true
EXTERNAL_KB_BACKFILL_BATCH_SIZE=50
EXTERNAL_KB_SYNC_TTL_HOURS=72
EXTERNAL_KB_GRAPH_WEIGHT=0.15
EXTERNAL_KB_MAX_CANDIDATES=5
EXTERNAL_KB_MIN_CONFIDENCE=0.45
EXTERNAL_KB_WIKIDATA_TIMEOUT_SEC=2.5
EXTERNAL_KB_OPENALEX_TIMEOUT_SEC=3.0
EXTERNAL_KB_DBPEDIA_ENABLED=false
EXTERNAL_KB_ORKG_ENABLED=false
EXTERNAL_KB_DBPEDIA_EXPLORER_ONLY=true
EXTERNAL_KB_ORKG_EXPLORER_ONLY=true
EXTERNAL_KB_DBPEDIA_TIMEOUT_SEC=2.5
EXTERNAL_KB_ORKG_TIMEOUT_SEC=3.0
EXTERNAL_KB_DBPEDIA_WEIGHT=0.08
EXTERNAL_KB_ORKG_WEIGHT=0.10
EXTERNAL_KB_HTTP_MAX_RETRY=1

# ============================================================================
# RETRIEVAL FUSION
# ============================================================================
# concat | rrf
RETRIEVAL_FUSION_MODE=concat

# ============================================================================
# SEARCH ROUTER
# ============================================================================
# static | rule_based
SEARCH_ROUTER_MODE=rule_based
SEARCH_MODE_ROUTING_ENABLED=true
# fast_exact | balanced | semantic_focus
SEARCH_DEFAULT_MODE=balanced
SEARCH_GRAPH_TIMEOUT_MS=120
SEARCH_GRAPH_BRIDGE_TIMEOUT_MS=650
SEARCH_GRAPH_BRIDGE_EXPLORER_ALWAYS_ATTEMPT=false
SEARCH_GRAPH_BRIDGE_EXPLORER_TIMEOUT_MS=950
SEARCH_GRAPH_DIRECT_SKIP=true
SEARCH_NOISE_GUARD_ENABLED=true
SEARCH_SMART_SEMANTIC_TAIL_CAP=6
SEARCH_TYPO_RESCUE_ENABLED=true
SEARCH_LEMMA_SEED_FALLBACK_ENABLED=true
SEARCH_DYNAMIC_SINGLE_TOKEN_SEMANTIC_CAP_ENABLED=true
SEARCH_SEMANTIC_EXPANSION_MAX_VARIATIONS=2
SEARCH_LOG_DIAGNOSTICS_PERSIST_ENABLED=false
SEARCH_LOG_RETENTION_CLEANUP_ENABLED=false
SEARCH_LOG_RETENTION_DAYS=90

# ============================================================================
# LAYER-3 PERFORMANCE (DEFAULT OFF - LEGACY QUALITY MODE)
# ============================================================================
L3_PERF_CONTEXT_BUDGET_ENABLED=false
L3_PERF_OUTPUT_BUDGET_ENABLED=false
L3_PERF_REWRITE_GUARD_ENABLED=false
L3_PERF_SUPPLEMENTARY_GATE_ENABLED=false
L3_PERF_EXPANSION_TAIL_FIX_ENABLED=false
L3_PERF_MAX_OUTPUT_TOKENS_STANDARD=1600
L3_PERF_CONTEXT_TOPK_STANDARD=12
L3_PERF_CONTEXT_CHARS_STANDARD=700
L3_QUOTE_DYNAMIC_COUNT_ENABLED=false
L3_QUOTE_DYNAMIC_MIN=2
L3_QUOTE_DYNAMIC_MAX=5
L3_JUDGE_DIVERSITY_AUDIT_ENABLED=false
L3_JUDGE_DIVERSITY_THRESHOLD=2

# ============================================================================
# FLOW TEXT REPAIR (LAYER 4 DISPLAY-TIME)
# ============================================================================
FLOW_TEXT_REPAIR_ENABLED=true
FLOW_TEXT_REPAIR_SOURCE_TYPES=PDF,EPUB,PDF_CHUNK,ARTICLE,WEBSITE
FLOW_TEXT_REPAIR_MAX_DELTA_RATIO=0.12
FLOW_TEXT_REPAIR_MAX_INPUT_CHARS=4000
FLOW_TEXT_REPAIR_RULESET_VERSION=tr_flow_v1
